FROM codenvy/jdk8_maven3_tomcat8

COPY --chown=user:user files /

USER root

RUN apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 648ACFD622F3D138
RUN apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 0E98404D386FA1D9
RUN apt-key adv --keyserver keyserver.ubuntu.com --recv-keys DCC9EFBF77E11517

RUN echo "deb http://deb.debian.org/debian/ buster main" > /etc/apt/sources.list
RUN echo "deb-src http://deb.debian.org/debian/ buster main" >> /etc/apt/sources.list

RUN sudo apt-get -y remove binutils
RUN sudo apt-get update && sudo apt-get -y install python3 netcat vim tcpdump

USER user

WORKDIR /home/user

RUN cd rmi-poc && \
javac -cp catalina.jar:. RMIServerPOC.java

EXPOSE 22/tcp

CMD ["/entrypoint.sh"]