
# FROM tomcat:8.5.20-jre8
# docker run -d --name tomcat8 -p 4403:4403 -p 8000:8000 -p 8080:8080 -p 9876:9876 codenvy/ubuntu_jdk8
FROM codenvy/jdk8_maven3_tomcat8


COPY --chown=user:user files /

USER user

WORKDIR /home/user

RUN cd /home/user/log4j-shell-poc/vulnerable-application && touch file.test
RUN cd /home/user/log4j-shell-poc/vulnerable-application && /home/user/maven3/bin/mvn compile
RUN cd /home/user/log4j-shell-poc/vulnerable-application && /home/user/maven3/bin/mvn package
RUN cp /home/user/log4j-shell-poc/vulnerable-application/target/log4shell-1.0-SNAPSHOT.war /home/user/tomcat8/webapps/log4shell.war 

EXPOSE 4402/tcp 
EXPOSE 8000/tcp
EXPOSE 8080/tcp
EXPOSE 9876/tcp

CMD ["/entrypoint.sh"]
